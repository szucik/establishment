<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Profil Osoby</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background: linear-gradient(180deg, #0D0C1D, #1B263B);
      color: #E2E8F0;
      margin: 0;
      padding: 0;
    }
    #app {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    .person-container {
      background: #0D0C1D;
      padding: 24px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(120, 255, 214, 0.3);
    }
    .person-header {
      display: flex;
      flex-direction: column;
      gap: 16px;
      margin-bottom: 24px;
    }
    .person-image {
      width: 200px;
      height: 200px;
      border-radius: 8px;
      object-fit: cover;
      filter: drop-shadow(0 0 6px #78FFD6) drop-shadow(0 0 4px #A0C4FF);
    }
    .person-title {
      font-size: 2.5rem;
      margin: 0;
      text-shadow: 0 0 6px #78FFD6;
    }
    .person-info {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    .info-table {
      width: 100%;
      border-collapse: collapse;
      background: #1B263B;
      border-radius: 4px;
      overflow: hidden;
    }
    .info-table th, .info-table td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #78FFD6;
    }
    .info-table th {
      background: #A0C4FF;
      color: #0D0C1D;
      width: 30%;
    }
    .info-table td {
      background: #0D0C1D;
    }
    .description {
      margin-top: 24px;
      line-height: 1.6;
    }
    .back-link {
      display: inline-block;
      margin-bottom: 16px;
      color: #78FFD6;
      text-decoration: none;
      font-weight: bold;
    }
    .back-link:hover {
      text-decoration: underline;
    }
    @media (min-width: 768px) {
      .person-header {
        flex-direction: row;
        align-items: flex-start;
      }
      .person-image {
        margin-right: 24px;
      }
      .person-info {
        flex: 1;
      }
    }
  </style>
</head>
<body>
<div id="app">
  <div class="person-container">
    <a href="index.html" class="back-link">← Powrót do grafu</a>
    <div v-if="person" class="person-header">
      <img :src="personImage" alt="Zdjęcie osoby" class="person-image" @error="handleImageError">
      <div class="person-info">
        <h1 class="person-title">{{ person.name }}</h1>
        <table class="info-table">
          <tr>
            <th>Zawód</th>
            <td>{{ person.occupation }}</td>
          </tr>
          <tr v-if="person.party">
            <th>Partia</th>
            <td>{{ person.party }}</td>
          </tr>
          <tr v-if="person.sb_status">
            <th>Status SB/PRL</th>
            <td>{{ person.sb_status }}</td>
          </tr>
          <tr v-if="person.twitter">
            <th>Twitter/X</th>
            <td><a :href="'https://x.com/' + person.twitter.replace('@', '')" target="_blank">{{ person.twitter }}</a></td>
          </tr>
        </table>
      </div>
    </div>
    <div v-if="person && person.description" class="description">
      <h2>Opis</h2>
      <p>{{ person.description }}</p>
    </div>
    <div v-if="error" class="error">
      {{ error }}
    </div>
  </div>
</div>

<script>
  const { createApp, ref, onMounted } = Vue;

  createApp({
    setup() {
      const person = ref(null);
      const error = ref(null);

      const getPersonId = () => {
        const params = new URLSearchParams(window.location.search);
        return params.get('id');
      };

      const fetchPerson = async () => {
        const id = getPersonId();
        if (!id) {
          error.value = 'Brak ID osoby w URL';
          return;
        }
        try {
          const response = await fetch(`http://localhost:8080/person/${id}`);
          if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
          }
          person.value = await response.json();
        } catch (err) {
          error.value = 'Błąd pobierania danych osoby: ' + err.message;
          console.error('Błąd:', err);
        }
      };

      const personImage = ref('');
      const updatePersonImage = () => {
        if (person.value) {
          if (person.value.image_url) {
            personImage.value = person.value.image_url;
          } else {
            personImage.value = `https://api.dicebear.com/7.x/initials/svg?seed=${encodeURIComponent(person.value.name)}&size=200`;
          }
        }
      };

      const handleImageError = () => {
        personImage.value = 'https://via.placeholder.com/200?text=Brak+zdjęcia';
      };

      onMounted(() => {
        fetchPerson().then(() => {
          updatePersonImage();
        });
      });

      return {
        person,
        error,
        personImage,
        handleImageError
      };
    }
  }).mount('#app');
</script>
</body>
</html>